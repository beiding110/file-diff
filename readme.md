# ğŸ‘‘ pdf å†…å®¹å¯¹æ¯” ğŸš€

## ğŸ”ï¸ å¯¹æ¯”å†…å®¹

- ğŸ“„ æ­£æ–‡
- ğŸ—ºï¸ å›¾ç‰‡
- ğŸ’¼ æ–‡ä»¶å±æ€§

æ”¯æŒå•çº¿ç¨‹ã€å¤šçº¿ç¨‹å¯¹æ¯”ã€‚å¯¹æ¯”é€Ÿç‡å¦‚ä¸‹ï¼š

| çº¿ç¨‹         | å•çº¿ç¨‹        | å¤šçº¿ç¨‹        |
| ------------ | ------------- | ------------- |
| æ–‡å­—å¯¹æ¯”é€Ÿç‡ | 3600 æ®µæ–‡å­—/s | 20000 æ®µæ–‡å­—/s |
| å›¾ç‰‡å¯¹æ¯”é€Ÿç‡ | 180 å›¾/s       | 300 å›¾/s       |
| å¯¹æ¯”æ—¶é—´     | 66.39s       | 20.92s       |

é€Ÿç‡å®éªŒå‚è€ƒæ–‡ä»¶ï¼š

| æ–‡ä»¶     | A æ–‡ä»¶   | B æ–‡ä»¶   |
| -------- | -------- | -------- |
| æ–‡å­—æ•°é‡ | 27767 å­— | 22810 å­— |
| å›¾ç‰‡æ•°é‡ | 92 å›¾    | 91 å›¾    |
| æ€»å¤§å°   | 19.99MB  | 14.84MB  |

## ğŸ§¬ å¯¹æ¯”è¿‡ç¨‹

- å°† pdf è¿›è¡Œç¼“å­˜
- å°† pdf è¿›è¡Œè§£æï¼Œè§£æä¸ºï¼šæ‹†åˆ†çš„æ–‡å­—æ®µè½ã€å›¾ç‰‡ã€å±æ€§ã€‚è§£ææœŸé—´å°†æ‰€æœ‰å›¾ç‰‡æå–ã€ç¼“å­˜
- å°†è§£æç»“æœè¿›è¡Œç¼“å­˜
- è®¡ç®— pdf ä¸¤ä¸¤äº¤å‰æ•°ç»„ï¼Œå‡†å¤‡ç”¨æ¥æ£€æµ‹
- æŒ‰ç»„è¿›è¡Œå¯¹æ¯”ï¼š
  - ï¼ˆå¦‚æœæœ‰éœ€è¦æ’é™¤çš„æ–‡å­—å†…å®¹ï¼Œåˆ™å…ˆå¯¹æ–‡å­—å†…å®¹è¿›è¡Œæ’é™¤ï¼‰
  - æ–‡å­—å¯¹æ¯”ï¼Œå°†é˜ˆå€¼ä»¥ä¸Šçš„ç»“æœä¿ç•™ï¼ˆåŒ…æ‹¬å¥é•¿ã€ä¸¤æ®µæ–‡å­—çš„é•¿åº¦æ¯”ï¼‰
  - å›¾ç‰‡å¯¹æ¯”ï¼Œå°†é˜ˆå€¼ä»¥ä¸Šçš„ç»“æœä¿ç•™ï¼ˆåŒ…æ‹¬å›¾ç‰‡å°ºå¯¸ã€ä¸¤å›¾ç‰‡çš„åƒç´ æ•°æ¯”ï¼‰
  - å±æ€§å¯¹æ¯”ï¼Œå°†ç›¸åŒå€¼çš„å±æ€§è¿›è¡Œæ ‡è®°
  - å¾—åˆ°ç»“æœæ•°ç»„
- ç¼“å­˜ç»“æœ
- è¿”å›ç»“æœ

## â›“ï¸ åŠŸèƒ½ç‚¹

### pdf è§£æ

> worker/parsePDF.worker.factory.js

ä½¿ç”¨ pdfjs å°†æ–‡ä»¶å†…å®¹è¿›è¡Œè§£æï¼Œåˆ†åˆ«æå–æ¯é¡µçš„æ–‡å­—ã€å›¾ç‰‡ã€‚

æ–‡å­—ï¼š

> parsePDF.worker.factory.js/\_getPageTexts

æå–é¡µå†…æ–‡å­—æ—¶ï¼Œæ ¹æ®ä»¥ä¸‹è§„åˆ™å¯¹æ–‡å­—è¿›è¡Œåˆ†æ®µï¼š

- ä¸åŒå­—ä½“çš„ï¼Œè®¤ä¸ºæ˜¯ä¸åŒçš„è¯­å¥
- å¸¸è§æ ‡ç‚¹ç¬¦å·ï¼ˆ\n.!?;ã€‚ï¼ï¼Ÿï¼›ï¼‰åˆ†å‰²çš„ï¼Œè®¤ä¸ºæ˜¯ä¸åŒè¯­å¥

å°†è§£æåçš„æ–‡å­—æ®µå’Œé¡µç å…³è”å­˜æ”¾ï¼Œè¿›è¡Œç¼“å­˜

å›¾ç‰‡ï¼š

> parsePDF.worker.factory.js/\_getPageImages

æ ¹æ® pdfjs ä¸­è¯†åˆ«åˆ°çš„å¯¹è±¡ï¼ˆgetOperatorListï¼‰ï¼Œå°†å›¾ç‰‡çš„ data æ•°æ®è½¬æ¢ä¸º png çš„ rgba æ•°æ®ï¼Œå¹¶ä½¿ç”¨ `sharp`è¿›è¡Œç¼“å­˜

### æ–‡å­—å¯¹æ¯”

> worker/diff.worder.factory.js

æ ¹æ®é¢„è®¾çš„è§„åˆ™ï¼Œå°†æ–‡å­—æ®µè¿›è¡Œä¸¤ä¸¤å¯¹æ¯”ã€‚å¯¹æ¯”æ—¶ï¼š

- ä¼˜å…ˆæ’é™¤é•¿åº¦ä¸ç¬¦åˆçš„é¡¹
- ç¬¦åˆçš„é¡¹ä½¿ç”¨ `diff`è¿›è¡Œå¯¹æ¯”ï¼Œå¹¶è·å–ç›¸ä¼¼åº¦
- ç•™å­˜ç¬¦åˆç›¸ä¼¼åº¦è¦æ±‚çš„é¡¹

### å›¾ç‰‡å¯¹æ¯”

> worker/sharp.worker.factory.js

æ ¹æ®é¢„è®¾çš„è§„åˆ™ï¼Œå°†å›¾ç‰‡è¿›è¡Œä¸¤ä¸¤å¯¹æ¯”ï¼Œå¯¹æ¯”æ—¶ï¼š

- ç§»é™¤é•¿ã€å®½è¿‡å°çš„å›¾ç‰‡
- ä½¿ç”¨ `sharp`ç»Ÿä¸€ä¸¤ä¸ªå›¾ç‰‡çš„å¤§å°
- é€ä¸ªåƒç´ è¿›è¡Œå¯¹æ¯”ï¼Œå¹¶æ±‚å‡ºåƒç´ ç›¸ä¼¼åº¦
- ç•™å­˜ç¬¦åˆç›¸ä¼¼åº¦è¦æ±‚çš„é¡¹

### å®ä½“æå–

> utils/EntityExtracter

é€šè¿‡ä¸‰ç§æ–¹å¼å®ç°å®ä½“æå–ï¼š

1. ã€regã€‘å…¨æ–‡æ­£åˆ™åŒ¹é…ï¼šå¦‚ï¼šæ—¶é—´ã€é‚®ç®±ï¼Œç­‰ `æœ‰å›ºå®šæ ¼å¼çš„`ã€‚
2. ã€conditionã€‘æ‹†åˆ†è¯æ€§åï¼Œæ ¹æ®æ¡ä»¶åŒ¹é…ï¼šå¦‚ï¼šæ‰‹æœºå·ã€äººåï¼Œç­‰ `å­˜åœ¨äºå•ä¸ªè¯è¯­ä¸­ï¼Œæœ‰å›ºå®šè§„å¾‹çš„`ã€‚
3. ã€contextã€‘æ‹†åˆ†è¯æ€§åï¼Œæ ¹æ®ä¸Šä¸‹æ–‡åŒ¹é…ï¼šå¦‚ï¼šåœ°ç‚¹ã€ç»„ç»‡ï¼Œç­‰ `å¤šä¸ªè¯è¯­é“¾æ¥è€Œæˆï¼Œæœ‰ä¸€å®šè§„å¾‹çš„`ã€‚

å…¶ä¸­æ‹†åˆ†è¯æ€§ä½¿ç”¨ `nodejiaba`å®ç°ã€‚

å·¥ä½œæµç¨‹ï¼š

1. ã€regã€‘å…¨æ–‡æ­£åˆ™åŒ¹é…ï¼šåŒ¹é… - æ ¡éªŒ - å¾—åˆ°ç»“æœ
2. ã€conditionã€‘æ‹†åˆ†è¯æ€§åï¼Œæ ¹æ®æ¡ä»¶åŒ¹é…ï¼šåˆ‡å‰²è¯æ€§ - é€ä¸ªåˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶ - å¾—åˆ°ç»“æœ
3. ã€contextã€‘æ‹†åˆ†è¯æ€§åï¼Œæ ¹æ®ä¸Šä¸‹æ–‡åŒ¹é…ï¼šåˆ‡å‰²è¯æ€§ - æ ¹æ®ä¸Šä¸‹æ–‡æ‘˜å–å€™é€‰è¯ç»„ - åˆ‡å‰²ä¸¤ç«¯ - æ ¡éªŒ - å¾—åˆ°ç»“æœ

å…¶ä¸­ï¼Œcontext æ”¯æŒ cutï¼ˆåŒ…æ‹¬ leftã€right ä¸¤ä¸ªå¯é€‰å±æ€§ï¼‰ï¼Œå³ä»æ¸ åˆ°çš„å¾…é€‰è¯ç»„ä¸¤ç«¯ï¼ˆleft å¯¹åº”å·¦ç«¯ï¼Œright å¯¹åº”å³ç«¯ï¼‰ï¼Œå°†æ»¡è¶³ cut æ¡ä»¶çš„è¯åˆ‡å‰²æŠ›å¼ƒæ‰ï¼Œç•™ä¸‹ä¸éœ€è¦åˆ‡å‰²çš„ç»“æœï¼›regã€context æ”¯æŒä½¿ç”¨ valid è¿›è¡Œæ ¡éªŒï¼Œå°†ä¸ç¬¦åˆæ ¡éªŒç»“æœçš„é¡¹ç›´æ¥æ’é™¤ï¼›

è¯æ€§å‚è€ƒï¼š

[CTCLAS æ±‰è¯­è¯æ€§æ ‡æ³¨é›†](https://www.cnblogs.com/chenbjin/p/4341930.html)
[å¸¸è§ä¸­æ–‡è¯æ€§æ ‡æ³¨é›†æ•´ç†](https://www.pianshen.com/article/940110595/)

## ğŸ“– ä½¿ç”¨æ–¹æ³•

```js
import BidComparator from './index.js';

// setCachePath å¯è®¾ç½®ç¼“å­˜ä½ç½®ã€‚é»˜è®¤ä¸ºæœ¬åº“ä¸Šå±‚çš„ /cache æ–‡ä»¶å¤¹
// BidComparator.setCachePath('path/to/cache')

// å®ä¾‹åŒ–
let comparator = new BidComparator();

// è®¾ç½®æ–‡å­—æ£€æŸ¥è¿›åº¦å›è°ƒå‡½æ•°
comparator.textCompareProgressHandlerFactory = function (id) {
    return function (num, str) {
        console.log(id, num, str);
    };
};

// è®¾ç½®å›¾ç‰‡æ£€æŸ¥è¿›åº¦å›è°ƒå‡½æ•°
comparator.imageCompareProgressHandlerFactory = function (id) {
    return function (num, str) {
        console.log(id, num, str);
    };
};

// æ–‡ä»¶å±æ€§æ£€æŸ¥è¾ƒå¿«ï¼Œä¸ç”¨è®¾ç½®å›è°ƒ

// é¢„å¤„ç†æ–‡ä»¶ï¼Œå°†æ–‡ä»¶ç¼“å­˜ã€è§£æ
BidComparator.preload('./docs/g2-3.pdf');

// æ›´æ–°å¯¹æ¯”è®¾ç½®
BidComparator.updateSettings({
    text: {
        threshold: 0.8, // ç›¸ä¼¼ç¨‹åº¦é˜ˆå€¼
        minLength: 15, // æœ€çŸ­å¥é•¿
    },
    image: {
        similarity: 0.9, // ç›¸ä¼¼ç¨‹åº¦é˜ˆå€¼
        resizeWidth: 100, // å¯¹æ¯”æ—¶ç»Ÿä¸€å°ºå¯¸
        minSize: 200, // æœ€å°å›¾ç‰‡å°ºå¯¸
    },
    workers: 'multi', // 'single'æ—¶ï¼Œä¸ºé”å®šå•çº¿ç¨‹æ£€æµ‹
});

// è¿›è¡Œå¯¹æ¯”
comparator
    .processFiles(
        [
            './docs/g2-1.pdf',
            './docs/g2-2.pdf',
            './docs/g2-3.pdf',
        ]
        './docs/g2-exclude.pdf' // éœ€è¦æ’é™¤çš„æ–‡å­—å†…å®¹
    )
    .then((res) => {
        // å…¨éƒ¨è§£æå®Œæˆçš„å›è°ƒ
        console.log(res);
    });
```

## âš ï¸ æ³¨æ„

- nodejieba å®‰è£…æ—¶ï¼Œè‡ªåŠ¨ç¼–è¯‘è„šæœ¬ä¼šæŠ¥é”™
  1. éœ€è¦ç”µè„‘å®‰è£… vs2022ï¼Œå¹¶å‹¾é€‰ä½¿ç”¨ c++ å¼€å‘
  2. å…ˆå¿½ç•¥æ‰§è¡Œè„šæœ¬å¹¶å®‰è£… `npm i nodejieba@2.6.0 --save --ignore-scripts`
  3. å°† `backup/StringUtil.hpp` å†…å®¹æ›¿æ¢åˆ° `node_modules/nodejieba/deps/limonp/StringUtil.hpp`
  4. è¿›å…¥ `node_modules/nodejieba` è¿è¡Œ `npm run install`
     å‚è€ƒï¼šhttps://travisbikkle.github.io/zh-hant/2024/07/chinese-search/
